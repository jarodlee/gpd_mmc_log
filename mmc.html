<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>eMMC Monitor</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { font-family: Arial; margin: 20px; }
.card {
    padding: 12px;
    margin: 10px 0;
    background: #f4f4f4;
    border-radius: 10px;
    font-size: 16px;
}
.alert { background: #ffcccc !important; color: red; font-weight: bold; }
@media (max-width: 600px) {
    body { margin: 10px; font-size: 15px; }
}
</style>
</head>
<body>

<h2>eMMC System Monitor</h2>

<div class="card">累计写入: <b id="total_tb"></b> TB</div>
<div class="card" id="today_card">今日写入: <b id="today_gb"></b> GB</div>
<div class="card">平均每日写入: <b id="avg_daily_gb"></b> GB</div>
<div class="card">已使用寿命: <b id="life_percent"></b> %</div>
<div class="card">预计剩余寿命: <b id="remaining_years"></b> 年</div>
<div class="card">电池: <b id="battery"></b></div>
<div class="card">SSD温度: <b id="temp"></b> °C</div>
<div class="card">无线IP: <b id="wifi_ip"></b></div>

<canvas id="chart"></canvas>

<script>
fetch('/mmc_data')
.then(res => res.json())
.then(data => {

    document.getElementById("total_tb").innerText = data.total_tb;
    document.getElementById("today_gb").innerText = data.today_gb;
    document.getElementById("avg_daily_gb").innerText = data.avg_daily_gb;
    document.getElementById("life_percent").innerText = data.life_used_percent;
    document.getElementById("remaining_years").innerText = data.remaining_years;

    if (data.battery_percent !== null) {
        document.getElementById("battery").innerText =
            data.battery_percent + "% (" + data.battery_status + ")";
    } else {
        document.getElementById("battery").innerText = "N/A";
    }

    document.getElementById("temp").innerText =
        data.temperature_c !== null ? data.temperature_c : "N/A";

    document.getElementById("wifi_ip").innerText =
        data.wifi_ip !== null ? data.wifi_ip : "N/A";

    if (data.alert) {
        document.getElementById("today_card").classList.add("alert");
    }

    const labels = data.history.map(x => new Date(x.time*1000).toLocaleString());
    const values = data.history.map(x => x.gb);

    new Chart(document.getElementById('chart'), {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'Total Written (GB)',
                data: values,
                fill: false,
                tension: 0.2
            }]
        }
    });
});
</script>

</body>
</html>
